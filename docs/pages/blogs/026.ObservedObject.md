---
title: æ•°æ®æµObservedObjectæ¢ç©¶
date: 2023-09-06 00:00:00
description: è¿‘æœŸå¿™äºé‡æ„ä»£ç ï¼Œå°è¯•è½å®MVVMæ€æƒ³ï¼Œä½†å¯èƒ½ç†è§£æœ‰åå·®ï¼Œåœ¨ä¸ºViewæ•´åˆViewModelæ—¶å‡ºç°ä¸¥é‡å¡é¡¿é—®é¢˜ï¼Œé‚ç ”ç©¶ä¸‹ObservedObjectå’ŒStateObject
img: ./pages/blogs/assets/post/026.png
---

# {{ $frontmatter.title }} <Badge type="tip" :text="String($frontmatter.date).slice(0,10)" />

::: info ğŸ“Œ èƒŒæ™¯
è¿‘æœŸå¿™äºé‡æ„ä»£ç ï¼Œå°è¯•è½å®MVVMæ€æƒ³ï¼Œä½†å¯èƒ½ç†è§£æœ‰åå·®ï¼Œåœ¨ä¸ºViewæ•´åˆViewModelæ—¶å‡ºç°ä¸¥é‡å¡é¡¿é—®é¢˜ï¼Œé‚ç ”ç©¶ä¸‹ObservedObjectå’ŒStateObject
:::


é—®é¢˜ä»£ç ï¼š

```
@ObservedObject private var vm = HomeViewModel()

class HomeViewModel: ObservableObject {
    @Published var isShowTab: Bool = false
    @Published var listMode: ListMode = .project
    @Published var isShowFloatBtn: Bool = false
		//...

}
```
åœ¨å­viewä¸­å¤ç”¨äº†æ­¤vm

æœ¬ä»¥ä¸ºå°†æ§åˆ¶è§†å›¾çŠ¶æ€çš„å˜é‡å­˜åœ¨vmé‡Œä¼šåˆç†äº›ï¼Œä¹Ÿä¼šä½¿viewå±‚æ›´ç®€æ´ï¼Œä½†è¿è¡Œåå‘ç°å½“ç›¸å…³å˜é‡å‘ç”Ÿæ”¹å˜æ—¶å¯¼è‡´äº†è‚‰çœ¼å¯è§çš„å¡é¡¿ã€‚

## ObservableObject

ObservableObjectæ˜¯Combineæ¡†æ¶ä¸‹çš„**åè®®ç±»å‹**ï¼Œé’ˆå¯¹å¼•ç”¨ç±»å‹è®¾è®¡ï¼Œç”¨äºåœ¨å¤šä¸ªViewä¹‹é—´å…±äº«æ•°æ®ï¼Œç›®å‰appä¸­çš„Storeå±‚å°±æ˜¯ç”¨è¯¥åè®®å®ç°ã€‚

ä¸ºå±æ€§æ·»åŠ @Publishedå¯ä»¥å®ç°ç›‘å¬çš„æ•ˆæœï¼Œå½“å€¼å‘ç”Ÿæ”¹å˜æ—¶ä¼šå‘é€ä¿¡å·é€šçŸ¥ç›¸å…³Viewè¿›è¡Œåˆ·æ–°ï¼Œ

ä¸€èˆ¬è¿™ä¸ªæ“ä½œä¼šè‡ªåŠ¨è¿›è¡Œï¼Œä½†å¦‚æœæˆ‘ä»¬æƒ³æ§åˆ¶å‘å‡ºä¿¡å·çš„æ—¶æœºï¼Œæ¯”å¦‚ä¿å­˜æ•°æ®åº“ï¼Œæ¡ä»¶è¿‡æ»¤ç­‰æ“ä½œåå†é€šçŸ¥æ›´æ–°UIï¼Œå°±éœ€è¦ç”¨åˆ°objectWillChangeï¼Œåœ¨ObservableObjectåè®®æ‰©å±•ä¸­å®ç°ï¼ŒObservableObjectPublisherç±»å‹ï¼Œå¾ªPublisheråè®®ã€‚

å®ç°ï¼š

```jsx
class UserAuthentication: ObservableObject {
    var username = "" {
        willSet {
            //æ¡ä»¶è¿‡æ»¤
            //.......
            objectWillChange.send()
        }
    }
}
```

@Publishedä½œç”¨å°±æ˜¯ç”¨æ¥æ›¿ä»£æ‰‹åŠ¨è°ƒç”¨ï¼Œå½“æ•°æ®è¢«setæ—¶è‡ªåŠ¨å‘å‡ºé€šçŸ¥

### ****@ObservedObject****

- ä½œä¸ºViewçš„æ•°æ®ä¾èµ–ï¼Œä¸è¢«ViewæŒæœ‰ï¼ŒViewæ›´æ–°æ—¶ObservedObjectå¯¹è±¡å¯èƒ½ä¼šè¢«é”€æ¯
- é€‚åˆæ•°æ®åœ¨SwiftUIå¤–éƒ¨å­˜å‚¨ï¼ŒæŠŠ@ObservedObjectåŒ…è£¹çš„æ•°æ®ä½œä¸ºè§†å›¾çš„ä¾èµ–ï¼Œæ¯”å¦‚æ•°æ®åº“ä¸­å­˜å‚¨çš„æ•°æ®

> ç›®å‰appä¸­çš„ä¸»æ•°æ®åŒ…æ‹¬å’Œå°±æ˜¯é€šè¿‡è¿™ç§æ–¹å¼å®ç°ï¼Œç›´æ¥è¢«viewå±‚è°ƒç”¨ã€‚
> 
- å½“viewè¢«é”€æ¯æ—¶ï¼ŒObservedObjectå¯¹è±¡ä¹Ÿä¼šè¢«é”€æ¯

### ****@StateObject****

- é’ˆå¯¹å¼•ç”¨ç±»å‹è®¾è®¡ï¼Œå½“Viewæ›´æ–°æ—¶ï¼Œå®ä¾‹ä¸ä¼šè¢«é”€æ¯ï¼Œä¸Stateç±»ä¼¼ï¼Œä½¿å¾—Viewæœ¬èº«æ‹¥æœ‰æ•°æ®
- @StateObject å’Œ @ObservedObject çš„åŒºåˆ«å°±æ˜¯å®ä¾‹æ˜¯å¦è¢«åˆ›å»ºå…¶çš„Viewæ‰€æŒæœ‰ï¼Œå…¶ç”Ÿå‘½å‘¨æœŸæ˜¯å¦å®Œå…¨å¯æ§ã€‚
- StateObjectè¡Œä¸ºç±»ä¼¼ObservedObjectå¯¹è±¡ï¼ŒåŒºåˆ«æ˜¯StateObjectç”±SwiftUIè´Ÿè´£é’ˆå¯¹ä¸€ä¸ªæŒ‡å®šçš„Viewï¼Œåˆ›å»ºå’Œç®¡ç†ä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œä¸ç®¡å¤šå°‘æ¬¡Viewæ›´æ–°ï¼Œéƒ½èƒ½å¤Ÿä½¿ç”¨æœ¬åœ°å¯¹è±¡æ•°æ®è€Œä¸ä¸¢å¤±

### å¯¹æ¯”

```jsx
struct Test2: View {
    @State var count = 0
    var body: some View {
        NavigationView{
            List{
                NavigationLink("@StateObject", destination: CountViewState())
                NavigationLink("@ObservedObject", destination: CountViewObserved())
            }
        }
    }
}
```

æµ‹è¯•2ä¸­ï¼Œç‚¹å‡»linkè¿›å…¥å¯¹åº”çš„è§†å›¾åé€šè¿‡ç‚¹å‡»+1è¿›è¡Œè®¡æ•°ï¼Œç„¶åè¿”å›çˆ¶è§†å›¾ã€‚å½“å†æ¬¡è¿›å…¥linkåï¼Œ@StateObjectå¯¹åº”çš„è§†å›¾ä¸­è®¡æ•°æ¸…é›¶ï¼Œè¿™æ˜¯ç”±äºè¿”å›çˆ¶è§†å›¾ï¼Œå†æ¬¡è¿›å…¥æ—¶ä¼šé‡æ–°åˆ›å»ºè§†å›¾ï¼Œæ‰€ä»¥ä¼šé‡æ–°åˆ›å»ºå®ä¾‹ï¼Œä¸è¿‡@ObservedObjectå¯¹åº”çš„è§†å›¾ä¸­è®¡æ•°æ˜¯ä¸æ¸…é›¶çš„ã€‚åœ¨è¿™ä¸ªæµ‹è¯•ä¸­ï¼Œ@ObservedObjectåˆ›å»ºçš„å®ä¾‹ç”Ÿå‘½å‘¨æœŸé•¿äºå½“å‰çš„Viewã€‚

æµ‹è¯•3ä¸­ç‚¹å‡»æŒ‰é’®ï¼Œåœ¨sheetä¸­ç‚¹å‡»+1,å½“å†æ¬¡è¿›å…¥sheetåï¼Œæ— è®ºæ˜¯@StateObjectè¿˜æ˜¯@ObservedObjectå¯¹åº”çš„Viewä¸­çš„è®¡æ•°éƒ½è¢«æ¸…é›¶ã€‚

## Reference

1. [SwiftUIæ•°æ®æµä¹‹StateObject& ObservedObjectæ¢è®¨](https://zhuanlan.zhihu.com/p/349079593#:~:text=%E7%9B%B8%E5%90%8C%E7%82%B9%EF%BC%9A%20StateObject%E8%BF%99%E4%B8%AApropertyWrapper%E4%B9%9F%E6%9C%89%E4%B8%80%E4%B8%AA%E8%8C%83%E5%9E%8B%E5%8F%82%E6%95%B0ObjectType%EF%BC%8C%E8%BF%99%E4%B8%AA%E5%8F%82%E6%95%B0%E9%81%B5%E5%BE%AAObservableObject%E5%8D%8F%E8%AE%AE%EF%BC%8C%E8%BF%99%E4%B8%8EObservedObject%E6%98%AF%E5%AE%8C%E5%85%A8%E4%B8%80%E8%87%B4%E7%9A%84%EF%BC%9B%20%E4%B8%A4%E4%B8%AAObject%E9%83%BD%E6%9C%89%E7%9B%B8%E5%90%8C%E7%9A%84%E6%8A%95%E5%BD%B1%E5%B1%9E%E6%80%A7projectedValue%EF%BC%8C%E7%B1%BB%E5%9E%8B%E9%83%BD%E6%98%AF%E5%9C%A8ObservedObject%E4%B8%AD%E5%AE%9A%E4%B9%89%E7%9A%84Wrapper%EF%BC%9B%20%E4%B8%8D%E5%90%8C%E7%82%B9%EF%BC%9A%20StateObject%E4%B8%ADwrappedValue%E6%98%AF%E5%8F%AA%E8%AF%BB%E5%B1%9E%E6%80%A7%EF%BC%8C%E8%80%8CObservedObject%E4%B8%ADwrappedValue%E6%98%AF%E8%AF%BB%E5%86%99%E5%B1%9E%E6%80%A7%EF%BC%9B%20init%E6%96%B9%E6%B3%95%E7%9A%84%E4%B8%8D%E5%90%8C%EF%BC%8CStateObject%E4%B8%AD%20init,%28wrappedValue%20thunk%3A%20%40autoclosure%20%40escaping%20%28%29%20-%3E%20ObjectType%29%20%E6%96%B9%E6%B3%95%E4%BC%A0%E5%85%A5%E5%8F%82%E6%95%B0%E6%94%AF%E6%8C%81%E4%B8%80%E4%B8%AA%E9%97%AD%E5%8C%85%EF%BC%8C%E8%BF%99%E4%B8%AA%E9%97%AD%E5%8C%85%E7%9A%84%E8%BF%94%E5%9B%9E%E7%B1%BB%E5%9E%8B%E6%98%AF%E9%81%B5%E5%BE%AAObservableObject%E5%8D%8F%E8%AE%AE%EF%BC%9BObservedObject%E4%B8%AD%E4%B8%A4%E4%B8%AAinit%E6%96%B9%E6%B3%95%E9%83%BD%E6%98%AF%E7%9B%B4%E6%8E%A5%E4%BC%A0%E5%80%BC%EF%BC%9B)